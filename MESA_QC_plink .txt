#To get into plink directory 
cd Plinkfiles

#Check Sex and Filter Out Missing Genotypes 
plink —-bfile MESA_all_autosome —-check-sex —-missing —-out MESA_all_autosome 
#—check-sex —>  compares sex assignments in input data to data imputed from X chromosome 
	#writes a report to plink.sexcheck  

	#515882 MB RAM detected; reserving 257941 MB for main workspace.
#8224 people (3789 males, 4435 females) loaded from .fam.
#Using 1 thread (no multithreaded calculations invoked).
#Before main variant filters, 6029 founders and 2195 nonfounders present.
#Calculating allele frequencies... done.
#Total genotyping rate is 0.996915.
#—missing: Sample missing data report written to MESA_all_autosome.imiss, and
#variant-based missing data report written to MESA_all_autosome.lmiss.
#872242 variants and 8224 people pass filters and QC.
#Note: No phenotypes present.
#Error: --check-sex/--impute-sex requires at least one polymorphic X chromosome
#locus.


#Recalculate Individual Call Rates After Removing SNPs with Call rates <99%
plink —-bfile MESA_all_autosome —-gene 0.01 —-make-bed —-out MESA_all_autosome 
#—gene snp-field —> filters out lines where coordinate is not contained in at least one gene and reorganizes genes by name
	#writes report to plink.range.report 

	#515882 MB RAM detected; reserving 257941 MB for main workspace.
#Note: --make-bed input and output filenames match.  Appending '~' to input
#filenames.
#872242 variants loaded from .bim file.
#8224 people (3789 males, 4435 females) loaded from .fam.
#Using 1 thread (no multithreaded calculations invoked).
#Before main variant filters, 6029 founders and 2195 nonfounders present.
#Calculating allele frequencies... done.
#Total genotyping rate is 0.996915.
#52303 variants removed due to missing genotype data (--geno).
#819939 variants and 8224 people pass filters and QC.
#Note: No phenotypes present.
#—make-bed to MESA_all_autosome.bed + MESA_all_autosome.bim +
#MESA_all_autosome.fam ... done.


plink —-bfile MESA_all_autosome —-missing —-out MESA_all_autosome 
#—missing —> produces sample-based and variant-based missing data reports
	

	#515882 MB RAM detected; reserving 257941 MB for main workspace.
#819939 variants loaded from .bim file.
#8224 people (3789 males, 4435 females) loaded from .fam.
#Using 1 thread (no multithreaded calculations invoked).
#Before main variant filters, 6029 founders and 2195 nonfounders present.
#Calculating allele frequencies... done.
#Total genotyping rate is 0.998685.
#—missing: Sample missing data report written to MESA_all_autosome.imiss, and
#variant-based missing data report written to MESA_all_autosome.lmiss.


#Calculate HWE Statistic to Flag SNPs 
plink -—bfile MESA_all_autosome —-hardy —-out MESA_all_autosome 
	#Writes list of genotype counts and Hardy-Weinberg equilibrium test to plink.hwe 

	#515882 MB RAM detected; reserving 257941 MB for main workspace.
#819939 variants loaded from .bim file.
#8224 people (3789 males, 4435 females) loaded from .fam.
#Using 1 thread (no multithreaded calculations invoked).
#Before main variant filters, 6029 founders and 2195 nonfounders present.
#Calculating allele frequencies... done.
#Total genotyping rate is 0.998685.
#—hardy: Writing Hardy-Weinberg report (founders only) to MESA_all_autosome.hwe
#… done.


#LD prune data for relationship check the heterozygosity calculation 
plink -—bfile MESA_all_autosome -—indep-pairwise 50 5 0.3 —-out MESA_all_autosome 
#—index-pairwise [window size] <kb> [step size (variant ct)] [r^2 threshold]
	#markers are in linkage equilibrium with each other 
	#writes IDs to plink.prune’
	#baed on correlations between genotype allele counts

	#515882 MB RAM detected; reserving 257941 MB for main workspace.
#819939 variants loaded from .bim file.
#8224 people (3789 males, 4435 females) loaded from .fam.
#Using 1 thread (no multithreaded calculations invoked).
#Before main variant filters, 6029 founders and 2195 nonfounders present.
#Calculating allele frequencies... done.
#Total genotyping rate is 0.998685.
#819939 variants and 8224 people pass filters and QC.
#Note: No phenotypes present.
#Pruned 46340 variants from chromosome 1, leaving 20782.
#Pruned 49027 variants from chromosome 2, leaving 20781.
#Pruned 39767 variants from chromosome 3, leaving 17497.
#Pruned 36540 variants from chromosome 4, leaving 16090.
#Pruned 37036 variants from chromosome 5, leaving 16223.
#Pruned 37106 variants from chromosome 6, leaving 15975.
#Pruned 30583 variants from chromosome 7, leaving 13797.
#Pruned 32321 variants from chromosome 8, leaving 13724.
#Pruned 27008 variants from chromosome 9, leaving 11955.
#Pruned 31570 variants from chromosome 10, leaving 13934.
#Pruned 29424 variants from chromosome 11, leaving 12562.
#Pruned 27270 variants from chromosome 12, leaving 12809.
#Pruned 22104 variants from chromosome 13, leaving 10231.
#Pruned 17752 variants from chromosome 14, leaving 8702.
#Pruned 16371 variants from chromosome 15, leaving 8333.
#Pruned 17385 variants from chromosome 16, leaving 8847.
#Pruned 12160 variants from chromosome 17, leaving 7321.
#Pruned 16739 variants from chromosome 18, leaving 8310.
#Pruned 6592 variants from chromosome 19, leaving 4579.
#Pruned 14372 variants from chromosome 20, leaving 7324.
#Pruned 7846 variants from chromosome 21, leaving 4003.
#Pruned 6653 variants from chromosome 22, leaving 4194.
#Pruning complete.  561966 of 819939 variants removed.
#Marker lists written to MESA_all_autosome.prune.in and
#MESA_all_autosome.prune.out .

#Relationship check with a min PI_HAT of 0.05 yields of IBD calculation
plink --bfile MESA_all_autosome --extract MESA_all_autosome.prune.in --genome --min 0.05 --out MESA_all_autosome 
	#—-extract —> removes all unlisted variants from the analysis 
	#—genome —> writes a report to plink.genome and causes IBS>IBD computation
	#—-min —> removes lines with PI_HAT values that are less than 0.05
		#the 0.05 is the minimum PI_HAT value for this question   


#PLINK v1.90b4.4 64-bit (21 May 2017)           www.cog-genomics.org/plink/1.9/
#(C) 2005-2017 Shaun Purcell, Christopher Chang   GNU General Public License v3
#Logging to MESA_all_autosome.log.
#Options in effect:
  #-—bfile MESA_all_autosome
  #-—extract MESA_all_autosome.prune.in
  #-—genome
  #-—min 0.05
  #-—out MESA_all_autosome

#515882 MB RAM detected; reserving 257941 MB for main workspace.
#819939 variants loaded from .bim file.
#8224 people (3789 males, 4435 females) loaded from .fam.
#-—extract: 261594 variants remaining.
#Warning: At least 2345 duplicate IDs in --extract file.
#Using up to 71 threads (change this with --threads).
#Before main variant filters, 6029 founders and 2195 nonfounders present.
#Calculating allele frequencies... done.
#Total genotyping rate is 0.998615.
#261594 variants and 8224 people pass filters and QC.
#Note: No phenotypes present.
#IBD calculations complete.  
#Finished writing MESA_all_autosome.genome . 

plink --bfile MESA_all_autosome --keep /home/lauren/MESA_dbGaP_55081/all_mesa_merged/afa_samples.txt --make-bed --out #MESA_AFA_autosome 
#PLINK v1.90b4.4 64-bit (21 May 2017)           www.cog-genomics.org/plink/1.9/
#(C) 2005-2017 Shaun Purcell, Christopher Chang   GNU General Public License v3
#Logging to MESA_AFA_autosome.log.
#Options in effect:
 #—bfile MESA_all_autosome
 # --keep /home/lauren/MESA_dbGaP_55081/all_mesa_merged/afa_samples.txt
  #—make-bed
 # --out MESA_AFA_autosome

#515882 MB RAM detected; reserving 257941 MB for main workspace.
#819939 variants loaded from .bim file.
#8224 people (3789 males, 4435 females) loaded from .fam.
#—keep: 2588 people remaining.
#Using 1 thread (no multithreaded calculations invoked).
#Before main variant filters, 1506 founders and 1082 nonfounders present.
#Calculating allele frequencies... done.
#Total genotyping rate in remaining samples is 0.998347.
#819939 variants and 2588 people pass filters and QC.
#Note: No phenotypes present.
#—make-bed to MESA_AFA_autosome.bed + MESA_AFA_autosome.bim +
#MESA_AFA_autosome.fam ... done.



plink --bfile MESA_all_autosome --keep /home/lauren/MESA_dbGaP_55081/all_mesa_merged/his_samples.txt --make-bed --out #MESA_HIS_autosome
#PLINK v1.90b4.4 64-bit (21 May 2017)           www.cog-genomics.org/plink/1.9/
#(C) 2005-2017 Shaun Purcell, Christopher Chang   GNU General Public License v3
#Logging to MESA_HIS_autosome.log.
#Options in effect:
 # --bfile MESA_all_autosome
 # --keep /home/lauren/MESA_dbGaP_55081/all_mesa_merged/his_samples.txt
 # --make-bed
 # --out MESA_HIS_autosome

#515882 MB RAM detected; reserving 257941 MB for main workspace.
#819939 variants loaded from .bim file.
#8224 people (3789 males, 4435 females) loaded from .fam.
#—keep: 2174 people remaining.
#Using 1 thread (no multithreaded calculations invoked).
#Before main variant filters, 1190 founders and 984 nonfounders present.
#Calculating allele frequencies... done.
#Total genotyping rate in remaining samples is 0.998575.
#819939 variants and 2174 people pass filters and QC.
#Note: No phenotypes present.
#—make-bed to MESA_HIS_autosome.bed + MESA_HIS_autosome.bim +
#MESA_HIS_autosome.fam ... done.




plink --bfile MESA_all_autosome --keep /home/lauren/MESA_dbGaP_55081/all_mesa_merged/cau_samples.txt --make-bed --out #MESA_CAU_autosome
#PLINK v1.90b4.4 64-bit (21 May 2017)           www.cog-genomics.org/plink/1.9/
#(C) 2005-2017 Shaun Purcell, Christopher Chang   GNU General Public License v3
#Logging to MESA_CAU_autosome.log.
#Options in effect:
 # --bfile MESA_all_autosome
 # --keep /home/lauren/MESA_dbGaP_55081/all_mesa_merged/cau_samples.txt
 # --make-bed
 # --out MESA_CAU_autosome

#515882 MB RAM detected; reserving 257941 MB for main workspace.
#819939 variants loaded from .bim file.
#8224 people (3789 males, 4435 females) loaded from .fam.
#-—keep: 2685 people remaining.
#Using 1 thread (no multithreaded calculations invoked).
#Before main variant filters, 2629 founders and 56 nonfounders present.
#Calculating allele frequencies... done.
#Total genotyping rate in remaining samples is 0.999021.
#819939 variants and 2685 people pass filters and QC.
#Note: No phenotypes present.
#-—make-bed to MESA_CAU_autosome.bed + MESA_CAU_autosome.bim +
#MESA_CAU_autosome.fam ... done.

plink --bfile MESA_AFA_autosome --indep-pairwise 50 5 0.3 --out MESA_AFA_autosome
#PLINK v1.90b4.4 64-bit (21 May 2017)           www.cog-genomics.org/plink/1.9/
#(C) 2005-2017 Shaun Purcell, Christopher Chang   GNU General Public License v3
#Logging to MESA_AFA_autosome.log.
#Options in effect:
#  --bfile MESA_AFA_autosome
#  --indep-pairwise 50 5 0.3
#  --out MESA_AFA_autosome

#515882 MB RAM detected; reserving 257941 MB for main workspace.
#819939 variants loaded from .bim file.
#2588 people (1130 males, 1458 females) loaded from .fam.
#Using 1 thread (no multithreaded calculations invoked).
#Before main variant filters, 1506 founders and 1082 nonfounders present.
#Calculating allele frequencies... done.
#Total genotyping rate is 0.998347.
#819939 variants and 2588 people pass filters and QC.
#Note: No phenotypes present.
#Pruned 40491 variants from chromosome 1, leaving 26631.
#Pruned 42631 variants from chromosome 2, leaving 27177.
#Pruned 34675 variants from chromosome 3, leaving 22589.
#Pruned 31843 variants from chromosome 4, leaving 20787.
#Pruned 32130 variants from chromosome 5, leaving 21129.
#Pruned 32348 variants from chromosome 6, leaving 20733.
#Pruned 26576 variants from chromosome 7, leaving 17804.
#Pruned 27970 variants from chromosome 8, leaving 18075.
#Pruned 23575 variants from chromosome 9, leaving 15388.
#Pruned 27578 variants from chromosome 10, leaving 17926.
#Pruned 25744 variants from chromosome 11, leaving 16242.
#Pruned 23792 variants from chromosome 12, leaving 16287.
#Pruned 19244 variants from chromosome 13, leaving 13091.
#Pruned 15400 variants from chromosome 14, leaving 11054.
#Pruned 13845 variants from chromosome 15, leaving 10859.
#Pruned 14893 variants from chromosome 16, leaving 11339.
#Pruned 10234 variants from chromosome 17, leaving 9247.
#Pruned 14457 variants from chromosome 18, leaving 10592.
#Pruned 5615 variants from chromosome 19, leaving 5556.
#Pruned 12432 variants from chromosome 20, leaving 9264.
#Pruned 6689 variants from chromosome 21, leaving 5160.
#Pruned 5612 variants from chromosome 22, leaving 5235.
#Pruning complete.  487774 of 819939 variants removed.
#Marker lists written to MESA_AFA_autosome.prune.in and
#MESA_AFA_autosome.prune.out .



plink --bfile MESA_HIS_autosome --indep-pairwise 50 5 0.3 --out MESA_HIS_autosome 
#PLINK v1.90b4.4 64-bit (21 May 2017)           www.cog-genomics.org/plink/1.9/
#(C) 2005-2017 Shaun Purcell, Christopher Chang   GNU General Public License v3
#Logging to MESA_HIS_autosome.log.
#Options in effect:
#  --bfile MESA_HIS_autosome
#  --indep-pairwise 50 5 0.3
#  --out MESA_HIS_autosome

#515882 MB RAM detected; reserving 257941 MB for main workspace.
#819939 variants loaded from .bim file.
#2174 people (993 males, 1181 females) loaded from .fam.
#Using 1 thread (no multithreaded calculations invoked).
#Before main variant filters, 1190 founders and 984 nonfounders present.
#Calculating allele frequencies... done.
#Total genotyping rate is 0.998575.
#819939 variants and 2174 people pass filters and QC.
#Note: No phenotypes present.
#Pruned 47230 variants from chromosome 1, leaving 19892.
#Pruned 49936 variants from chromosome 2, leaving 19872.
#Pruned 40575 variants from chromosome 3, leaving 16689.
#Pruned 37267 variants from chromosome 4, leaving 15363.
#Pruned 37882 variants from chromosome 5, leaving 15377.
#Pruned 37830 variants from chromosome 6, leaving 15251.
#Pruned 31200 variants from chromosome 7, leaving 13180.
#Pruned 33052 variants from chromosome 8, leaving 12993.
#Pruned 27626 variants from chromosome 9, leaving 11337.
#Pruned 32215 variants from chromosome 10, leaving 13289.
#Pruned 29986 variants from chromosome 11, leaving 12000.
#Pruned 27881 variants from chromosome 12, leaving 12198.
#Pruned 22603 variants from chromosome 13, leaving 9732.
#Pruned 18231 variants from chromosome 14, leaving 8223.
#Pruned 16791 variants from chromosome 15, leaving 7913.
#Pruned 17778 variants from chromosome 16, leaving 8454.
#Pruned 12519 variants from chromosome 17, leaving 6962.
#Pruned 17123 variants from chromosome 18, leaving 7926.
#Pruned 6763 variants from chromosome 19, leaving 4408.
#Pruned 14671 variants from chromosome 20, leaving 7025.
#Pruned 8034 variants from chromosome 21, leaving 3815.
#Pruned 6849 variants from chromosome 22, leaving 3998.
#Pruning complete.  574042 of 819939 variants removed.
#Marker lists written to MESA_HIS_autosome.prune.in and
#MESA_HIS_autosome.prune.out .



plink --bfile MESA_CAU_autosome --indep-pairwise 50 5 0.3 --out MESA_CAU-autosome 
#PLINK v1.90b4.4 64-bit (21 May 2017)           www.cog-genomics.org/plink/1.9/
#(C) 2005-2017 Shaun Purcell, Christopher Chang   GNU General Public License v3
#Logging to MESA_CAU-autosome.log.
#Options in effect:
#  --bfile MESA_CAU_autosome
#  --indep-pairwise 50 5 0.3
#  --out MESA_CAU-autosome

#515882 MB RAM detected; reserving 257941 MB for main workspace.
#819939 variants loaded from .bim file.
#2685 people (1285 males, 1400 females) loaded from .fam.
#Using 1 thread (no multithreaded calculations invoked).
#Before main variant filters, 2629 founders and 56 nonfounders present.
#Calculating allele frequencies... done.
#Total genotyping rate is 0.999021.
#819939 variants and 2685 people pass filters and QC.
#Note: No phenotypes present.
#Pruned 48240 variants from chromosome 1, leaving 18882.
#Pruned 50911 variants from chromosome 2, leaving 18897.
#Pruned 41533 variants from chromosome 3, leaving 15731.
#Pruned 38194 variants from chromosome 4, leaving 14436.
#Pruned 38735 variants from chromosome 5, leaving 14524.
#Pruned 38642 variants from chromosome 6, leaving 14439.
#Pruned 32067 variants from chromosome 7, leaving 12313.
#Pruned 33809 variants from chromosome 8, leaving 12236.
#Pruned 28159 variants from chromosome 9, leaving 10804.
#Pruned 32854 variants from chromosome 10, leaving 12650.
#Pruned 30625 variants from chromosome 11, leaving 11361.
#Pruned 28637 variants from chromosome 12, leaving 11442.
#Pruned 23158 variants from chromosome 13, leaving 9177.
#Pruned 18652 variants from chromosome 14, leaving 7802.
#Pruned 17228 variants from chromosome 15, leaving 7476.
#Pruned 18189 variants from chromosome 16, leaving 8043.
#Pruned 12839 variants from chromosome 17, leaving 6642.
#Pruned 17559 variants from chromosome 18, leaving 7490.
#Pruned 6975 variants from chromosome 19, leaving 4196.
#Pruned 15083 variants from chromosome 20, leaving 6613.
#Pruned 8293 variants from chromosome 21, leaving 3556.
#Pruned 7156 variants from chromosome 22, leaving 3691.
#Pruning complete.  587538 of 819939 variants removed.
#Marker lists written to MESA_CAU-autosome.prune.in and
#MESA_CAU-autosome.prune.out .



plink --bfile MESA_AFA_autosome --extract MESA_AFA_autosome.prune.in --genome --min 0.05 --out MESA_AFA_autosome 
#PLINK v1.90b4.4 64-bit (21 May 2017)           www.cog-genomics.org/plink/1.9/
#(C) 2005-2017 Shaun Purcell, Christopher Chang   GNU General Public License v3
#Logging to MESA_AFA_autosome.log.
#Options in effect:
#  --bfile MESA_AFA_autosome
#  --extract MESA_AFA_autosome.prune.in
#  --genome
#  --min 0.05
#  --out MESA_AFA_autosome

#515882 MB RAM detected; reserving 257941 MB for main workspace.
#819939 variants loaded from .bim file.
#2588 people (1130 males, 1458 females) loaded from .fam.
#--extract: 335859 variants remaining.
#Warning: At least 2542 duplicate IDs in --extract file.
#Using up to 71 threads (change this with --threads).
#Before main variant filters, 1506 founders and 1082 nonfounders present.
#Calculating allele frequencies... done.
#Total genotyping rate is 0.998297.
#335859 variants and 2588 people pass filters and QC.
#Note: No phenotypes present.
#IBD calculations complete.  
#Finished writing MESA_AFA_autosome.genome .




plink --bfile MESA_HIS_autosome --extract MESA_HIS_autosome.prune.in --genome --min 0.05 --out MESA_HIS_autosome 
#PLINK v1.90b4.4 64-bit (21 May 2017)           www.cog-genomics.org/plink/1.9/
#(C) 2005-2017 Shaun Purcell, Christopher Chang   GNU General Public License v3
#Logging to MESA_HIS_autosome.log.
#Options in effect:
#  --bfile MESA_HIS_autosome
#  --extract MESA_HIS_autosome.prune.in
#  --genome
#  --min 0.05
#  --out MESA_HIS_autosome

#515882 MB RAM detected; reserving 257941 MB for main workspace.
#819939 variants loaded from .bim file.
#2174 people (993 males, 1181 females) loaded from .fam.
#--extract: 249631 variants remaining.
#Warning: At least 2208 duplicate IDs in --extract file.
#Using up to 71 threads (change this with --threads).
#Before main variant filters, 1190 founders and 984 nonfounders present.
#Calculating allele frequencies... done.
#Total genotyping rate is 0.998555.
#249631 variants and 2174 people pass filters and QC.
#Note: No phenotypes present.
#IBD calculations complete.  
#Finished writing MESA_HIS_autosome.genome 



plink --bfile MESA_CAU_autosome --extract MESA_CAU-autosome.prune.in --genome --min 0.05 --out MESA_CAU_autosome 
#PLINK v1.90b4.4 64-bit (21 May 2017)           www.cog-genomics.org/plink/1.9/
#(C) 2005-2017 Shaun Purcell, Christopher Chang   GNU General Public License v3
#Logging to MESA_CAU_autosome.log.
#Options in effect:
#  --bfile MESA_CAU_autosome
#  --extract MESA_CAU-autosome.prune.in
#  --genome
#  --min 0.05
#  --out MESA_CAU_autosome

#515882 MB RAM detected; reserving 257941 MB for main workspace.
#819939 variants loaded from .bim file.
#2685 people (1285 males, 1400 females) loaded from .fam.
#-—extract: 236023 variants remaining.
#Warning: At least 2230 duplicate IDs in --extract file.
#Using up to 71 threads (change this with --threads).
#Before main variant filters, 2629 founders and 56 nonfounders present.
#Calculating allele frequencies... done.
#Total genotyping rate is 0.998754.
#236023 variants and 2685 people pass filters and QC.
#Note: No phenotypes present.
#IBD calculations complete.  
#Finished writing MESA_CAU_autosome.genome .

#step 6.1 was repeated for individual populations
#step 10.1 was completed in RStudio 

plink --bed MESA_AFA_autosome.bed~ --bim MESA_AFA_autosome.bim~ --fam MESA_AFA_autosome.fam~ --geno 0.01 --make-bed --out #MESA_AFA_autosome.geno0.01 
#PLINK v1.90b4.4 64-bit (21 May 2017)           www.cog-genomics.org/plink/1.9/
#(C) 2005-2017 Shaun Purcell, Christopher Chang   GNU General Public License v3
#Logging to MESA_AFA_autosome.geno0.01.log.
#Options in effect:
  #--bed MESA_AFA_autosome.bed~
  #--bim MESA_AFA_autosome.bim~
  #--fam MESA_AFA_autosome.fam~
 # --geno 0.01
 # --make-bed
 # --out MESA_AFA_autosome.geno0.01

#515882 MB RAM detected; reserving 257941 MB for main workspace.
#819939 variants loaded from .bim file.
#2588 people (1130 males, 1458 females) loaded from .fam.
#Using 1 thread (no multithreaded calculations invoked).
#Before main variant filters, 1506 founders and 1082 nonfounders present.
#Calculating allele frequencies... done.
#Total genotyping rate is 0.998347.
#19613 variants removed due to missing genotype data (--geno).
#800326 variants and 2588 people pass filters and QC.
#Note: No phenotypes present.
#--make-bed to MESA_AFA_autosome.geno0.01.bed + MESA_AFA_autosome.geno0.01.bim +
#MESA_AFA_autosome.geno0.01.fam ... done.

####USE MESA_AFA_autosome.geno0.01 for the rest of the steps in the workshop###


plink --bed MESA_HIS_autosome.bed --bim MESA_HIS_autosome.bim --fam MESA_HIS_autosome.fam --geno 0.01 --make-bed --out MESA_HIS_autosome.geno0.01
#PLINK v1.90b4.4 64-bit (21 May 2017)           www.cog-genomics.org/plink/1.9/
#(C) 2005-2017 Shaun Purcell, Christopher Chang   GNU General Public License v3
#Logging to MESA_HIS_autosome.geno0.01.log.
#Options in effect:
#  --bed MESA_HIS_autosome.bed
#  --bim MESA_HIS_autosome.bim
#  --fam MESA_HIS_autosome.fam
#  --geno 0.01
#  --make-bed
#  --out MESA_HIS_autosome.geno0.01

#515882 MB RAM detected; reserving 257941 MB for main workspace.
#819939 variants loaded from .bim file.
#2174 people (993 males, 1181 females) loaded from .fam.
#Using 1 thread (no multithreaded calculations invoked).
#Before main variant filters, 1190 founders and 984 nonfounders present.
#Calculating allele frequencies... done.
#Total genotyping rate is 0.998575.
#10388 variants removed due to missing genotype data (--geno).
#809551 variants and 2174 people pass filters and QC.
#Note: No phenotypes present.
#--make-bed to MESA_HIS_autosome.geno0.01.bed + MESA_HIS_autosome.geno0.01.bim +
#MESA_HIS_autosome.geno0.01.fam ... done.

###USE MESA_HIS_autosome.geno0.01 for rest of the steps in the workshop###

plink --bed MESA_CAU_autosome.bed --bim MESA_CAU_autosome.bim --fam MESA_CAU_autosome.fam --geno 0.01 --make-bed --out MESA_CAU_autosome.geno0.01
#PLINK v1.90b4.4 64-bit (21 May 2017)           www.cog-genomics.org/plink/1.9/
#(C) 2005-2017 Shaun Purcell, Christopher Chang   GNU General Public License v3
#Logging to MESA_CAU_autosome.geno0.01.log.
#Options in effect:
 # --bed MESA_CAU_autosome.bed
 # --bim MESA_CAU_autosome.bim
 # --fam MESA_CAU_autosome.fam
 # --geno 0.01
 # --make-bed
 # --out MESA_CAU_autosome.geno0.01

#515882 MB RAM detected; reserving 257941 MB for main workspace.
#819939 variants loaded from .bim file.
#2685 people (1285 males, 1400 females) loaded from .fam.
#Using 1 thread (no multithreaded calculations invoked).
#Before main variant filters, 2629 founders and 56 nonfounders present.
#Calculating allele frequencies... done.
#Total genotyping rate is 0.999021.
#6137 variants removed due to missing genotype data (--geno).
#813802 variants and 2685 people pass filters and QC.
#Note: No phenotypes present.
#--make-bed to MESA_CAU_autosome.geno0.01.bed + MESA_CAU_autosome.geno0.01.bim +
#MESA_CAU_autosome.geno0.01.fam ... done.

###USE MESA_CAU_autosome.geno0.01 for the rest of the workshop###

plink --bfile MESA_AFA_autosome.geno0.01 --remove AFA_outliers.txt --make-bed --out MESA_AFA_autosome.geno0.01.sd
#PLINK v1.90b4.4 64-bit (21 May 2017)           www.cog-genomics.org/plink/1.9/
#(C) 2005-2017 Shaun Purcell, Christopher Chang   GNU General Public License v3
#Logging to MESA_AFA_autosome.geno0.01.sd.log.
#Options in effect:
 # --bfile MESA_AFA_autosome.geno0.01
 # --make-bed
 # --out MESA_AFA_autosome.geno0.01.sd
 # --remove AFA_outliers.txt

#515882 MB RAM detected; reserving 257941 MB for main workspace.
#800326 variants loaded from .bim file.
#2588 people (1130 males, 1458 females) loaded from .fam.
#--remove: 2561 people remaining.
#Using 1 thread (no multithreaded calculations invoked).
#Before main variant filters, 1496 founders and 1065 nonfounders present.
#Calculating allele frequencies... done.
#Total genotyping rate in remaining samples is 0.998825.
#800326 variants and 2561 people pass filters and QC.
#Note: No phenotypes present.
#--make-bed to MESA_AFA_autosome.geno0.01.sd.bed +
#MESA_AFA_autosome.geno0.01.sd.bim + MESA_AFA_autosome.geno0.01.sd.fam ... done.

plink --bfile MESA_HIS_autosome.geno0.01 --remove HIS_outliers.txt --make-bed --out MESA_HIS_autosome.geno0.01.sd
#PLINK v1.90b4.4 64-bit (21 May 2017)           www.cog-genomics.org/plink/1.9/
#(C) 2005-2017 Shaun Purcell, Christopher Chang   GNU General Public License v3
#Logging to MESA_HIS_autosome.geno0.01.sd.log.
#Options in effect:
#  --bfile MESA_HIS_autosome.geno0.01
#  --make-bed
#  --out MESA_HIS_autosome.geno0.01.sd
#  --remove HIS_outliers.txt

#515882 MB RAM detected; reserving 257941 MB for main workspace.
#809551 variants loaded from .bim file.
#2174 people (993 males, 1181 females) loaded from .fam.
#--remove: 2157 people remaining.
#Using 1 thread (no multithreaded calculations invoked).
#Before main variant filters, 1184 founders and 973 nonfounders present.
#Calculating allele frequencies... done.
#Total genotyping rate in remaining samples is 0.998826.
#809551 variants and 2157 people pass filters and QC.
#Note: No phenotypes present.
#--make-bed to MESA_HIS_autosome.geno0.01.sd.bed +
#MESA_HIS_autosome.geno0.01.sd.bim + MESA_HIS_autosome.geno0.01.sd.fam ... done.

plink --bfile MESA_CAU_autosome.geno0.01 --remove CAU_outliers.txt --make-bed --out MESA_CAU_autosome.geno0.01.sd
#PLINK v1.90b4.4 64-bit (21 May 2017)           www.cog-genomics.org/plink/1.9/
#(C) 2005-2017 Shaun Purcell, Christopher Chang   GNU General Public License v3
#Logging to MESA_CAU_autosome.geno0.01.sd.log.
#Options in effect:
#  --bfile MESA_CAU_autosome.geno0.01
#  --make-bed
#  --out MESA_CAU_autosome.geno0.01.sd
#  --remove CAU_outliers.txt

#515882 MB RAM detected; reserving 257941 MB for main workspace.
#813802 variants loaded from .bim file.
#2685 people (1285 males, 1400 females) loaded from .fam.
#--remove: 2633 people remaining.
#Using 1 thread (no multithreaded calculations invoked).
#Before main variant filters, 2579 founders and 54 nonfounders present.
#Calculating allele frequencies... done.
#Total genotyping rate in remaining samples is 0.999246.
#813802 variants and 2633 people pass filters and QC.
#Note: No phenotypes present.
#--make-bed to MESA_CAU_autosome.geno0.01.sd.bed +
#MESA_CAU_autosome.geno0.01.sd.bim + MESA_CAU_autosome.geno0.01.sd.fam ... done.


plink --bfile MESA_AFA_autosome.geno0.01.sd --recode --out MESA_AFA_4lift
#PLINK v1.90b4.4 64-bit (21 May 2017)           www.cog-genomics.org/plink/1.9/
#(C) 2005-2017 Shaun Purcell, Christopher Chang   GNU General Public License v3
#Logging to MESA_AFA_4lift.log.
#Options in effect:
#  --bfile MESA_AFA_autosome.geno0.01.sd
#  --out MESA_AFA_4lift
#  --recode

#515882 MB RAM detected; reserving 257941 MB for main workspace.
#800326 variants loaded from .bim file.
#2561 people (1124 males, 1437 females) loaded from .fam.
#Using 1 thread (no multithreaded calculations invoked).
#Before main variant filters, 1496 founders and 1065 nonfounders present.
#Calculating allele frequencies... done.
#Total genotyping rate is 0.998825.
#800326 variants and 2561 people pass filters and QC.
#Note: No phenotypes present.
#Calculating allele frequencies... done.
#Total genotyping rate is 0.998825.
#800326 variants and 2561 people pass filters and QC.
#Note: No phenotypes present.
#--recode ped to MESA_AFA_4lift.ped + MESA_AFA_4lift.map ... done.

plink --bfile MESA_HIS_autosome.geno0.01.sd --recode --out MESA_HIS_4lift
#PLINK v1.90b4.4 64-bit (21 May 2017)           www.cog-genomics.org/plink/1.9/
#(C) 2005-2017 Shaun Purcell, Christopher Chang   GNU General Public License v3
#Logging to MESA_HIS_4lift.log.
#Options in effect:
#  --bfile MESA_HIS_autosome.geno0.01.sd
#  --out MESA_HIS_4lift
#  --recode

#515882 MB RAM detected; reserving 257941 MB for main workspace.
#809551 variants loaded from .bim file.
#2157 people (981 males, 1176 females) loaded from .fam.
#Using 1 thread (no multithreaded calculations invoked).
#Before main variant filters, 1184 founders and 973 nonfounders present.
#Calculating allele frequencies... done.
#Total genotyping rate is 0.998826.
#809551 variants and 2157 people pass filters and QC.
#Note: No phenotypes present.
#--recode ped to MESA_HIS_4lift.ped + MESA_HIS_4lift.map ... done.

plink --bfile MESA_CAU_autosome.geno0.01.sd --recode --out MESA_CAU_4lift
#PLINK v1.90b4.4 64-bit (21 May 2017)           www.cog-genomics.org/plink/1.9/
#(C) 2005-2017 Shaun Purcell, Christopher Chang   GNU General Public License v3
#Logging to MESA_CAU_4lift.log.
#Options in effect:
#  --bfile MESA_CAU_autosome.geno0.01.sd
#  --out MESA_CAU_4lift
#  --recode

#515882 MB RAM detected; reserving 257941 MB for main workspace.
#813802 variants loaded from .bim file.
#2633 people (1268 males, 1365 females) loaded from .fam.
#Using 1 thread (no multithreaded calculations invoked).
#Before main variant filters, 2579 founders and 54 nonfounders present.
#Calculating allele frequencies... done.
#Total genotyping rate is 0.999246.
#813802 variants and 2633 people pass filters and QC.
#Note: No phenotypes present.
#--recode ped to MESA_CAU_4lift.ped + MESA_CAU_4lift.map ... done.









#run liftover script with new ped/mapfiles
###With AFA population###
python /home/lauren/MESA_dbGaP_55081/all_mesa_merged/liftover/LiftMap.py -m MESA_AFA_4lift.map -p MESA_AFA_4lift.ped -o mesa_afa_new
#SUCC:  map->bed succ
#Reading liftover chains
#Mapping coordinates
#SUCC:  liftBed succ
#SUCC:  bed->map succ

plink --file MESA_AFA_4lift --exclude mesa_afa_new.bed.unlifted --recode --out AFA_tolift

python /home/lauren/MESA_dbGaP_55081/all_mesa_merged/liftover/LiftMap.py -m AFA_tolift.map -p AFA_tolift.ped -o mesa_afa_use

plink --file mesa_afa_use --make-bed --out MESA_AFA_lifted_final


###WITH HIS population###

python /home/lauren/MESA_dbGaP_55081/all_mesa_merged/liftover/LiftMap.py -m MESA_HIS_4lift.map -p MESA_HIS_4lift.ped -o mesa_his_new

plink --file MESA_HIS_4lift --exclude mesa_his_new.bed.unlifted --recode --out HIS_tolift


python /home/lauren/MESA_dbGaP_55081/all_mesa_merged/liftover/LiftMap.py -m HIS_tolift.map -p HIS_tolift.ped -o mesa_his_use


plink --file mesa_his_use --make-bed --out MESA_HIS_lifted_final



###WITH CAU population###
python /home/lauren/MESA_dbGaP_55081/all_mesa_merged/liftover/LiftMap.py -m MESA_CAU_4lift.map -p MESA_CAU_4lift.ped -o mesa_cau_new

plink --file MESA_CAU_4lift --exclude mesa_cau_new.bed.unlifted --recode --out CAU_tolift

python /home/lauren/MESA_dbGaP_55081/all_mesa_merged/liftover/LiftMap.py -m CAU_tolift.map -p CAU_tolift.ped -o mesa_cau_use

plink --file mesa_cau_use --make-bed --out MESA_CAU_lifted_final











##filter by genotyping rate and maf (unmerged)##
plink --bfile MESA_AFA_lifted_final --geno 0.05 --maf 0.05 --make-bed   --out MESA_AFA_lifted_filt

plink --bfile MESA_HIS_lifted_final --geno 0.05 --maf 0.05 --make-bed  --out MESA_HIS_lifted_filt

plink --bfile MESA_CAU_lifted_final --geno 0.05 --maf 0.05 --make-bed  --out MESA_CAU_lifted_filt


##LD prune MESA files with removed individuals and make ped/map files (unmerged)
plink --bfile MESA_AFA_lifted_filt --indep-pairwise 50 5 0.3 --recode  --out MESA_AFA_autosome.geno0.01.sd.pruned

plink --bfile  MESA_HIS_lifted_filt --indep-pairwise 50 5 0.3 --recode --out MESA_HIS_autosome.geno0.01.sd.pruned

plink --bfile MESA_CAU_lifted_filt --indep-pairwise 50 5 0.3 --recode --out MESA_CAU_autosome.geno0.01.sd.pruned

START HERE 
##Merge pruned data with HAPMAP##
###WITH AFA population###
 
plink --bfile  MESA_AFA_lifted_final --bmerge /home/lauren/MESA_dbGaP_55081/all_mesa_merged/hapmap_hg19/HM3_ASN_CEU_YRI_Unrelated_hg19_noAmbig.bed  /home/lauren/MESA_dbGaP_55081/all_mesa_merged/hapmap_hg19/HM3_ASN_CEU_YRI_Unrelated_hg19_noAmbig.bim /home/lauren/MESA_dbGaP_55081/all_mesa_merged/hapmap_hg19/HM3_ASN_CEU_YRI_Unrelated_hg19_noAmbig.fam --make-bed --out MESA_AFA_mergedHAPMAP

plink --bfile /home/lauren/MESA_dbGaP_55081/all_mesa_merged/hapmap_hg19/HM3_ASN_CEU_YRI_Unrelated_hg19_noAmbig --exclude MESA_AFA_mergedHAPMAP-merge.missnp --make-bed --out hapmap19use

plink --bfile MESA_AFA_lifted_final --bmerge hapmap19use.bed hapmap19use.bim hapmap19use.fam --make-bed --out MESA_HIS_mergedHAPMAP


###WITH HIS population###
plink --bfile MESA_HIS_lifted_final --bmerge /home/lauren/MESA_dbGaP_55081/all_mesa_merged/hapmap_hg19/HM3_ASN_CEU_YRI_Unrelated_hg19_noAmbig.bed  /home/lauren/MESA_dbGaP_55081/all_mesa_merged/hapmap_hg19/HM3_ASN_CEU_YRI_Unrelated_hg19_noAmbig.bim /home/lauren/MESA_dbGaP_55081/all_mesa_merged/hapmap_hg19/HM3_ASN_CEU_YRI_Unrelated_hg19_noAmbig.fam --make-bed --out MESA_HIS_mergedHAPMAP

plink --bfile /home/lauren/MESA_dbGaP_55081/all_mesa_merged/hapmap_hg19/HM3_ASN_CEU_YRI_Unrelated_hg19_noAmbig --exclude MESA_HIS_mergedHAPMAP-merge.missnp --make-bed --out hapmap19use

plink --bfile MESA_HIS_lifted_final --bmerge hapmap19use.bed hapmap19use.bim hapmap19use.fam --make-bed --out MESA_HIS_mergedHAPMAP


###WITH CAU population###
plink --bfile MESA_CAU_lifted_final --bmerge /home/lauren/MESA_dbGaP_55081/all_mesa_merged/hapmap_hg19/HM3_ASN_CEU_YRI_Unrelated_hg19_noAmbig.bed  /home/lauren/MESA_dbGaP_55081/all_mesa_merged/hapmap_hg19/HM3_ASN_CEU_YRI_Unrelated_hg19_noAmbig.bim /home/lauren/MESA_dbGaP_55081/all_mesa_merged/hapmap_hg19/HM3_ASN_CEU_YRI_Unrelated_hg19_noAmbig.fam --make-bed --out MESA_CAU_mergedHAPMAP

plink --bfile /home/lauren/MESA_dbGaP_55081/all_mesa_merged/hapmap_hg19/HM3_ASN_CEU_YRI_Unrelated_hg19_noAmbig --exclude MESA_CAU_mergedHAPMAP-merge.missnp --make-bed --out hapmap19use

plink --bfile MESA_CAU_lifted_final --bmerge hapmap19use.bed hapmap19use.bim hapmap19use.fam --make-bed --out MESA_CAU_mergedHAPMAP

###filter by genotyping rate and maf (merged)
###WITH AFA population 
plink --bfile MESA_AFA_mergedHAPMAP --geno 0.05 --maf 0.05 --make-bed   --out MESA_AFA_mergedHAPMAP0.05

###WITH HIS population 
plink --bfile MESA_HIS_mergedHAPMAP --geno 0.05 --maf 0.05 --make-bed  --out MESA_HIS_mergedHAPMAP0.05

###WITH CAU population 
plink --bfile MESA_CAU_mergedHAPMAP --geno 0.05 --maf 0.05 --make-bed  --out MESA_CAU_mergedHAPMAP0.05

###LD prune MESA files with removed individuals and make ped/map files (merged)
###WITH AFA population 
plink --bfile MESA_AFA_mergedHAPMAP0.05 --indep-pairwise 50 5 0.3 --recode  --out MESA_AFA_mergedHAPMAP0.05

###WITH HIS population 
plink --bfile  MESA_HIS_mergedHAPMAP0.05 --indep-pairwise 50 5 0.3 --recode --out MESA_HIS_mergedHAPMAP0.05


###WITH CAU population 
plink --bfile MESA_CAU_mergedHAPMAP0.05 --indep-pairwise 50 5 0.3 --recode --out MESA_CAU_mergedHAPMAP0.05


#reformat fam file for PCA
##unmerged
awk '{print $1, $2, $3, $4, $5, 1}' MESA_AFA_lifted_filt.fam > MESA_AFA_autosome.geno0.01.sd.4pca.fam

awk '{print $1, $2, $3, $4, $5, 1}' MESA_AFA_lifted_filt.fam > MESA_HIS_autosome.geno0.01.sd.4pca.fam

awk '{print $1, $2, $3, $4, $5, 1}' MESA_AFA_lifted_filt.fam > MESA_CAU_autosome.geno0.01.sd.4pca.fam

###merged with hapmap
awk '{print $1, $2, $3, $4, $5, 1}' MESA_AFA_mergedHAPMAP0.05.fam > MESA_AFA_merged_hapmap.4pca.fam

awk '{print $1, $2, $3, $4, $5, 1}' MESA_HIS_mergedHAPMAP0.05.fam > MESA_HIS_merged_hapmap.4pca.fam

awk '{print $1, $2, $3, $4, $5, 1}' MESA_CAU_mergedHAPMAP0.05.fam > MESA_CAU_merged_hapmap.4pca.fam

#19 MAKE .par FILE FOR PCA 
###WITH AFA population not merged 
nano AFA.par
#genotypename: /home/rachel/Plinkfiles/Revised_QC/ MESA_AFA_autosome.geno0.01.sd.pruned.ped                                                
#snpname: /home/rachel/Plinkfiles/Revised_QC/ MESA_AFA_autosome.geno0.01.sd.pruned.map
#indivname: /home/rachel/Plinkfiles/Revised_QC/ MESA_AFA_autosome.geno0.01.sd.pruned.fam
#evecoutname: /home/rachel/Plinkfiles/Revised_QC/AFA_hapmap.evec
#evaloutname: /home/rachel/Plinkfiles/Revised_QC/AFA_hapmap.eval
#numoutevec: 10
#numoutlieriter: 0
#numoutlierevec: 2
#outliersigmathresh: 6 
#control x --> yes --> keep file name --> AFA.par


###WITH HIS population not merged   
nano AFA.par
#genotypename: /home/rachel/Plinkfiles/Revised_QC/ MESA_HIS_autosome.geno0.01.sd.pruned.ped                                                 
#snpname: /home/rachel/Plinkfiles/Revised_QC/ MESA_HIS_autosome.geno0.01.sd.pruned.map
#indivname: /home/rachel/Plinkfiles/Revised_QC/ MESA_HIS_autosome.geno0.01.sd.pruned.fam
#evecoutname: /home/rachel/Plinkfiles/Revised_QC/HIS_hapmap.evec
#evaloutname: /home/rachel/Plinkfiles/Revised_QC/HIS_hapmap.eval
#numoutevec: 10
#numoutlieriter: 0
#numoutlierevec: 2
#outliersigmathresh: 6 
#control x --> yes --> keep file name --> HIS.par


###WITH CAU population not merged 
nano AFA.par
#genotypename: /home/rachel/Plinkfiles/Revised_QC/ MESA_CAU_autosome.geno0.01.sd.pruned.ped                                                 
#snpname: /home/rachel/Plinkfiles/Revised_QC/ MESA_CAU_autosome.geno0.01.sd.pruned.map
#indivname: /home/rachel/Plinkfiles/Revised_QC/ MESA_CAU_autosome.geno0.01.sd.pruned.fam
#evecoutname: /home/rachel/Plinkfiles/Revised_QC/CAU_hapmap.evec
#evaloutname: /home/rachel/Plinkfiles/Revised_QC/CAU_hapmap.eval
#numoutevec: 10
#numoutlieriter: 0
#numoutlierevec: 2
#outliersigmathresh: 6 
#control x --> yes --> keep file name --> CAU.par

###WITH AFA population merged 
nano AFA.par
genotypename: /home/rachel/Plinkfiles/Revised_QC/MESA_AFA_mergedHAPMAP0.05.ped
snpname: /home/rachel/Plinkfiles/Revised_QC/MESA_AFA_mergedHAPMAP0.05.map
indivname: /home/rachel/Plinkfiles/Revised_QC/MESA_AFA_merged_hapmap.4pca.fam
evecoutname: /home/rachel/Plinkfiles/Revised_QC/afa_mergedHAPMAP_auto.evec
evaloutname: /home/rachel/Plinkfiles/Revised_QC/afa_mergedHAPMAP_auto.eval
numoutevec: 10
numoutlieriter: 0
numoutlierevec: 2
outliersigmathresh: 6
#control x --> yes --> keep file name --> AFA_hapmap.par

###WITH HIS population merged 
nano AFA.par
genotypename: /home/rachel/Plinkfiles/Revised_QC/MESA_HIS_mergedHAPMAP0.05.ped
snpname: /home/rachel/Plinkfiles/Revised_QC/MESA_HIS_mergedHAPMAP0.05.map
indivname: /home/rachel/Plinkfiles/Revised_QC/MESA_HIS_merged_hapmap.4pca.fam
evecoutname: /home/rachel/Plinkfiles/Revised_QC/his_mergedHAPMAP_auto.evec
evaloutname: /home/rachel/Plinkfiles/Revised_QC/his_mergedHAPMAP_auto.eval
numoutevec: 10
numoutlieriter: 0
numoutlierevec: 2
outliersigmathresh: 6 
#control x --> yes --> keep file name --> HIS_hapmap.par

###WITH CAU population merged 
nano AFA.par
genotypename: /home/rachel/Plinkfiles/Revised_QC/MESA_CAU_mergedHAPMAP0.05.ped
snpname: /home/rachel/Plinkfiles/Revised_QC/MESA_CAU_mergedHAPMAP0.05.map
indivname: /home/rachel/Plinkfiles/Revised_QC/MESA_CAU_merged_hapmap.4pca.fam
evecoutname: /home/rachel/Plinkfiles/Revised_QC/CAU_mergedHAPMAP_auto.evec
evaloutname: /home/rachel/Plinkfiles/Revised_QC/CAU_mergedHAPMAP_auto.eval
numoutevec: 10
numoutlieriter: 0
numoutlierevec: 2
outliersigmathresh: 6
#control x --> yes --> keep file name --> CAU_hapmap.par


#run PCA
smartpca -p AFA.par 
smartpca -p AFA_hapmap.par 

smartpca -p HIS.par
smartpca -p HIS_hapmap.par

smartpca -p CAU.par 
smartpca -p CAU_hapmap.par

#In R
#Unmerged 
#AFA
hapmappopinfo <- read.table("/home/lauren/MESA_dbGaP_55081/all_mesa_merged/hapmap_hg19/pop_HM3_hg19_forPCA.txt") %>% select(V1,V3)select(V1,V3)
colnames(hapmappopinfo) <- c("pop","IID")
fam_AFA<- read.table('/home/rachel/Plinkfiles/Revised_QC/MESA_AFA_merged_hapmap.4pca.fam') %>% select(V1,V2)
colnames(fam_AFA) <- c("FID","IID")
popinfo_AFA <- left_join(fam_AFA,hapmappopinfo,by="IID")
popinfo_AFA <- mutate(popinfo, pop=ifelse(grepl('T',IID),'Norway',as.character(pop))) %>% mutate(pop=ifelse(is.na(pop),'AFA',as.character(pop)))
table(popinfo_AFA)
#ASN CEU YRI 
#170 111 110

pcs_AFAhap <- read.table("/home/rachel/Plinkfiles/Revised_QC/AFA_hapmap.evec",skip=1)
pcdf_AFAhap <- data.frame(popinfo_AFA,pcs_AFAhap[,2:11]) %>% rename(PC1=V2,PC2=V3,PC3=V4,PC4=V5,PC5=V6,PC6=V7,PC7=V8,PC8=V9,PC9=V10,PC10=V11)


gwas_AFAhap <- filter(pcdf_AFAhap,pop=='AFA') %>% mutate(PATNO=IID)
hm3_AFA <- filter(pcdf_AFAhap,grepl('NA',IID))
table(gwas_AFAhap$pop)
table(hm3$pop)

#HIS
hapmappopinfo <- read.table("/home/lauren/MESA_dbGaP_55081/all_mesa_merged/hapmap_hg19/pop_HM3_hg19_forPCA.txt") %>% select(V1,V3)
colnames(hapmappopinfo) <- c("pop","IID")
fam_HIS<- read.table('/home/rachel/Plinkfiles/Revised_QC/MESA_HIS_merged_hapmap.4pca.fam') %>% select(V1,V2)
colnames(fam_HIS) <- c("FID","IID")
popinfo_HIS <- left_join(fam_h,hapmappopinfo,by="IID")
popinfo_HIS <- mutate(popinfo, pop=ifelse(grepl('T',IID),'Norway',as.character(pop))) %>% mutate(pop=ifelse(is.na(pop),'HIS',as.character(pop)))
table(popinfo_HIS)

pcs_HIShap <- read.table("/home/rachel/Plinkfiles/Revised_QC/his_merged_auto.evec",skip=1)
pcdf_HIShap <- data.frame(popinfo,pcs_HIShap[,2:11]) %>% rename(PC1=V2,PC2=V3,PC3=V4,PC4=V5,PC5=V6,PC6=V7,PC7=V8,PC8=V9,PC9=V10,PC10=V11)

gwas_HIShap <- filter(pcdf_HIShap,pop=='HIS') %>% mutate(PATNO=IID)
hm3_HIS <- filter(pcdf_HIShap,grepl('NA',IID))
table(gwas_HIShap$pop)
table(hm3$pop)

#CAU
hapmappopinfo <- read.table("/home/lauren/MESA_dbGaP_55081/all_mesa_merged/hapmap_hg19/pop_HM3_hg19_forPCA.txt") %>% select(V1,V3)
colnames(hapmappopinfo) <- c("pop","IID")
fam_CAU<- read.table('/home/rachel/Plinkfiles/Revised_QC/MESA_CAU_merged_hapmap.4pca.fam') %>% select(V1,V2)
colnames(fam_CAU) <- c("FID","IID")
popinfo_CAU <- left_join(fam_h,hapmappopinfo,by="IID")
popinfo_CAU <- mutate(popinfo_CAU, pop=ifelse(grepl('T',IID),'Norway',as.character(pop))) %>% mutate(pop=ifelse(is.na(pop),'CAU',as.character(pop)))
table(popinfo_CAU)

pcs_CAUhap <- read.table("/home/rachel/Plinkfiles/Revised_QC/cau_merged_auto.evec",skip=1)
pcdf_CAUhap <- data.frame(popinfo,pcs_CAUhap[,2:11]) %>% rename(PC1=V2,PC2=V3,PC3=V4,PC4=V5,PC5=V6,PC6=V7,PC7=V8,PC8=V9,PC9=V10,PC10=V11)

gwas_CAUhap <- filter(pcdf_CAUhap,pop=='HIS') %>% mutate(PATNO=IID)
hm3_CAU <- filter(pcdf_CAUhap,grepl('NA',IID))
table(gwas_CAUhap$pop)
table(hm3$pop)

hapmappopinfo <- read.table("/home/lauren/MESA_dbGaP_55081/all_mesa_merged/hapmap_hg19/pop_HM3_hg19_forPCA.txt") %>% select(V1,V3)
colnames(hapmappopinfo) <- c("pop","IID")
fam_AFA<- read.table("/home/rachel/Plinkfiles/Revised_QC/MESA_AFA_merged_hapmap.4pca.fam") %>% select(V1,V2)
colnames(fam_AFA) <- c("FID","IID")
popinfo_AFA <- left_join(fam_h,hapmappopinfo,by="IID")
popinfo_AFA <- mutate(popinfo, pop=ifelse(grepl('T',IID),'Norway',as.character(pop))) %>% mutate(pop=ifelse(is.na(pop),'CAU',as.character(pop)))
table(popinfo$pop)

pcs_AFAhap <- read.table("/home/rachel/Plinkfiles/Revised_QC/afa_merged_auto.evec",skip=1)
pcdf_AFAhap <- data.frame(popinfo,pcs_CAUhap[,2:11]) %>% rename(PC1=V2,PC2=V3,PC3=V4,PC4=V5,PC5=V6,PC6=V7,PC7=V8,PC8=V9,PC9=V10,PC10=V11)

gwas_AFAhap <- filter(pcdf_AFAhap,pop=='HIS') %>% mutate(PATNO=IID)
hm3_AFA <- filter(pcdf_AFAhap,grepl('NA',IID))
table(gwas_AFAhap$pop)
table(hm3$pop)


##calc proportion variance explained by each PC
eval_hishap <- scan("/home/lauren/MESA_dbGaP_55081/all_mesa_merged/his_merged_auto.eval")[1:10]
round(eval_hishap/sum(eval_hishap),3)
#pdf(file=my.dir %&% "MESA_PCA.pdf")
ggplot() + geom_point(data=pcdf_hishap,aes(x=PC1,y=PC2,col=pop,shape=pop))+geom_point(data=hm3,aes(x=PC1,y=PC2,col=pop,shape=pop))+ theme_bw() + scale_colour_brewer(palette="Set1")

ggplot() + geom_point(data=gwas,aes(x=PC1,y=PC3,col=pop,shape=pop))+geom_point(data=hm3,aes(x=PC1,y=PC3,col=pop,shape=pop))+ theme_bw() + scale_colour_brewer(palette="Set1")

ggplot() + geom_point(data=gwas,aes(x=PC2,y=PC3,col=pop,shape=pop))+geom_point(data=hm3,aes(x=PC2,y=PC3,col=pop,shape=pop))+ theme_bw() + scale_colour_brewer(palette="Set1")
#dev.off()




